<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>应用导航</title>
  <!-- 使用原生 CSS/JS/HTML，不依赖 Bootstrap -->
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --app-primary-color:#0a84ff; --app-primary-light:rgba(10,132,255,.1);
      --app-background:#f5f5f5; --app-surface:#fff;
      --text-primary:#1d1d1f; --text-secondary:#86868b; --border-color:rgba(0,0,0,.1);
    }
    [data-theme=dark] {
      --app-primary-color:#0a84ff; --app-primary-light:rgba(10,132,255,.2);
      --app-background:#1c1c1e; --app-surface:#2c2c2e;
      --text-primary:#fff; --text-secondary:#ebebf0; --border-color:rgba(255,255,255,.1);
    }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:var(--app-background); color:var(--text-primary); height:100vh; overflow:hidden; -webkit-font-smoothing:antialiased; }
    .container { height:100vh; display:flex; flex-direction:column; overflow-y:auto; -webkit-overflow-scrolling:touch; }
    .status-bar { padding:.5rem 1rem; display:flex; justify-content:flex-end; align-items:center; }
    .app-icons-wrapper { flex:1; padding:1rem; display:grid; grid-template-columns:repeat(auto-fill,minmax(90px,1fr)); grid-auto-rows:minmax(90px,auto); gap:1.5rem; width:100%; max-width:1200px; margin:0 auto; align-content:start; }
    .app-icon { text-decoration:none; display:flex; flex-direction:column; align-items:center; }
    .app-icon-image { width:64px; height:64px; border-radius:16px; margin-bottom:.3rem; display:flex; align-items:center; justify-content:center; overflow:hidden; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    .app-icon:hover .app-icon-image { transform:translateY(-3px) scale(1.03); box-shadow:0 4px 10px rgba(0,0,0,.1); }
    .app-icon-image svg { width:100%; height:100%; display:block; }
    .app-name { font-size:.85rem; color:var(--text-primary); text-align:center; max-width:80px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .app-icon:hover .app-name { color:var(--app-primary-color); }
    .theme-toggle { background:var(--app-surface); border:none; cursor:pointer; width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(0,0,0,.12); position:relative; }
    .theme-toggle .sun-icon,.theme-toggle .moon-icon { position:absolute; fill:var(--text-primary); }
    .theme-toggle .sun-icon { opacity:1; stroke:var(--text-primary); stroke-width:1.5; stroke-linecap:round; fill:none; }
    .theme-toggle .moon-icon { opacity:0; }
    [data-theme=dark] .theme-toggle .sun-icon { opacity:0; transform:translateY(-20px); }
    [data-theme=dark] .theme-toggle .moon-icon { opacity:1; transform:translateY(0); }
    @media (max-width:768px){ .app-icons-wrapper{ grid-template-columns:repeat(4,1fr); gap:1rem; padding:.8rem; } .app-icon-image{ width:55px; height:55px; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="status-bar">
      <button id="theme-toggle" class="theme-toggle" title="切换主题">
        <svg class="sun-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="4.5" />
          <line x1="12" y1="2" x2="12" y2="4" />
          <line x1="12" y1="20" x2="12" y2="22" />
          <line x1="4" y1="12" x2="2" y2="12" />
          <line x1="22" y1="12" x2="20" y2="12" />
          <line x1="6.34" y1="6.34" x2="4.93" y2="4.93" />
          <line x1="19.07" y1="19.07" x2="17.66" y2="17.66" />
          <line x1="6.34" y1="17.66" x2="4.93" y2="19.07" />
          <line x1="19.07" y1="4.93" x2="17.66" y2="6.34" />
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M21.5 14.0784C20.3003 14.7189 18.9341 15.0821 17.4849 15.0821C12.9237 15.0821 9.22612 11.3845 9.22612 6.82334C9.22612 5.37545 9.59114 4.0109 10.2322 2.8125C6.36838 3.9234 3.5 7.45216 3.5 11.636C3.5 16.7325 7.63757 20.87 12.734 20.87C16.9262 20.87 20.4603 18.0075 21.5 14.0784Z" />
        </svg>
      </button>
    </div>
    <div class="app-icons-wrapper" id="app-container"></div>
  </div>
  <script type="module">
    import { getAppDirectories } from './apps.js';

    const Theme = {
      getTheme(){ return localStorage.getItem('app-theme') || 'light' },
      setTheme(t){ localStorage.setItem('app-theme', t); document.body.setAttribute('data-theme', t) },
      toggle(){ const t=this.getTheme()==='light'?'dark':'light'; this.setTheme(t); return t },
      init(){ this.setTheme(this.getTheme()) }
    };

    const appColors = { mail:'#FF453A', contacts:'#FF9F0A', photos:'#30D158', calendar:'#FFD60A', todo:'#5E5CE6', cloud:'#0A84FF', default:'#FFFFFF' };

    const getDirFromPath = (p) => { if(!p) return ''; const i=p.indexOf('/'); return i===-1?p:p.slice(0,i); };
    const resolveIcon = async (dir) => {
      const candidates = [`./pages/${dir}/icon.svg`,`./pages/${dir}/icon`];
      for(const url of candidates){
        try{ const res = await fetch(url); if(!res.ok) continue; const ct=(res.headers.get('content-type')||'').toLowerCase();
          if(ct.includes('image/svg')) return { type:'svg', content: await res.text() };
          return { type:'img', url };
        }catch(e){}
      }
      return null;
    };

    async function loadApps(){
      const container = document.getElementById('app-container');
      try{
        const apps = await getAppDirectories();
        for(const app of apps){
          const dir = getDirFromPath(app.path);
          const icon = await resolveIcon(dir);
          const el = document.createElement('a');
          el.href = `./pages/${app.path}`; el.className='app-icon';
          if(icon){
            const inner = icon.type==='svg' ? `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center">${icon.content}</div>` : `<img src="${icon.url}" alt="${app.name}" style="width:100%;height:100%;object-fit:contain;display:block">`;
            el.innerHTML = `<div class="app-icon-wrapper"><div class="app-icon-image">${inner}</div><div class="app-name">${app.name}</div></div>`;
          }else{
            const bg = appColors[dir] || appColors.default; const tc = bg==='#FFFFFF' ? '#000' : '#FFF';
            el.innerHTML = `<div class="app-icon-wrapper"><div class="app-icon-image" style="background-color:${bg}"><div style="width:60%;height:60%;display:flex;align-items:center;justify-content:center;color:${tc};font-weight:bold;font-size:18px">${app.name.charAt(0)}</div></div><div class="app-name">${app.name}</div></div>`;
          }
          container.appendChild(el);
        }
      }catch(e){ container.innerHTML = '<p>加载应用失败，请稍后重试</p>'; }
    }

    document.addEventListener('DOMContentLoaded', ()=>{ Theme.init(); loadApps(); document.getElementById('theme-toggle').addEventListener('click', ()=>Theme.toggle()); });
  </script>
</body>
</html>
